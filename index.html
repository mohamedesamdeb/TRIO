<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ø°ÙƒÙŠ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --success-color: #27ae60;
            --danger-color: #c0392b;
            --accent-color: #3498db;
            --warning-bg: #fff3cd;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            width: 95%;
            max-width: 450px;
            text-align: center;
            z-index: 1;
        }

        h2 { color: var(--primary-color); margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; }

        .input-group { position: relative; margin-bottom: 15px; }
        .input-group i { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); color: var(--accent-color); }

        input, select {
            width: 100%;
            padding: 14px 45px 14px 15px;
            border: 1px solid #ddd;
            border-radius: 12px;
            box-sizing: border-box;
            font-size: 16px;
            outline: none;
        }

        button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: 0.3s;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-login, .btn-geo { background-color: var(--accent-color); color: white; }
        .btn-attendance { background-color: var(--success-color); color: white; }
        .btn-leave { background-color: var(--danger-color); color: white; }

        /* --- ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ ÙÙˆÙ‚ Ø§Ù„ÙƒÙ„ --- */
        #camera-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85); /* Ø®Ù„ÙÙŠØ© Ø³ÙˆØ¯Ø§Ø¡ Ø´ÙØ§ÙØ© */
            display: none; /* Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
            justify-content: center;
            align-items: center;
            z-index: 9999; /* Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø£ÙŠ Ø¹Ù†ØµØ± Ø¢Ø®Ø± */
        }

        #camera-content {
            background: white;
            padding: 10px;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }

        #camera-container {
            border-radius: 15px;
            overflow: hidden;
            background: #000;
            position: relative;
            aspect-ratio: 3/4; /* Ù…Ù†Ø§Ø³Ø¨ Ù„Ø´ÙƒÙ„ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        }

        video { width: 100%; height: 100%; object-fit: cover; }

        #countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 100px;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(0,0,0,0.8);
        }

        .address-box {
            background: #eef2f3;
            padding: 12px;
            border-radius: 10px;
            border-right: 5px solid var(--accent-color);
            font-size: 14px;
            color: #34495e;
            margin: 15px 0;
            text-align: right;
        }

        .warning-box {
            background: var(--warning-bg);
            border: 1px solid #ffeeba;
            padding: 15px;
            border-radius: 12px;
            text-align: right;
            font-size: 14px;
            margin-top: 20px;
            color: #856404;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

<div id="login-page" class="container">
    <h2><i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <div class="input-group">
        <i class="fas fa-user"></i>
        <input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
    </div>
    <div class="input-group">
        <i class="fas fa-lock"></i>
        <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    </div>
    <button class="btn-login" onclick="handleLogin()">Ø¯Ø®ÙˆÙ„</button>
    <p id="login-error" style="color: var(--danger-color); display: none; font-weight: bold;">âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!</p>
</div>

<div id="main-page" class="container hidden">
    <h2>Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</h2>
    
    <div class="input-group">
        <select id="technician-name">
            <option value="">Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„ÙÙ†ÙŠ...</option>
            <option>Ø¹Ù„Ù‰ Ø§Ø­Ù…Ø¯ Ø·Ù†Ø·Ø§ÙˆÙ‰ Ù…Ù†ØµÙˆØ±</option>
            <option>Ø´Ø§Ø¯Ù‰ Ø±Ø£ÙØª Ø±ÙØ§Ø¹Ù‰ Ù…Ø­Ù…ÙˆØ¯ ØµØ§Ù„Ø­</option>
            <option>Ù…Ø­Ù…Ø¯ Ø­Ø³ÙŠÙ† Ù…Ø­Ù…Ø¯ Ø¹Ø§Ù…Ø±</option>
            <option>Ù…ØµØ·ÙÙŠ Ø³Ø§Ù…Ù‰ Ù…ØµØ·ÙÙŠ Ø¯Ø§ÙˆØ¯</option>
            <option>Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ Ø£Ø¨Ø±Ø§Ù‡ÙŠÙ…</option>
            <option>Ù…Ø­Ù…ÙˆØ¯ Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ù„Ø¨Ù„ÙŠÙ‡Ù‰</option>
            <option>Ø³Ø¹ÙŠØ¯ Ø­Ø³ÙŠÙ† Ø¹Ù„ÙŠ Ø£Ø³Ù…Ø§Ø¹ÙŠÙ„</option>
            <option>Ù…Ø­Ù…ÙˆØ¯ Ù…Ø­Ù…Ø¯ Ù…Ø­Ù…ÙˆØ¯ Ø£Ø­Ù…Ø¯</option>
            <option>Ø¨Ø§Ø³Ù… Ù†Ø´Ø£Øª ØµØ§Ù„Ø­</option>
            <option>Ø§Ø¨Ø§Ù†ÙˆØ¨ Ø²ØºÙ„ÙˆÙ„ Ø¹Ø§Ø²Ø± Ù…ÙŠØ®Ø§Ø¦ÙŠÙ„</option>
            <option>Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ù‡ ØªÙˆÙÙŠÙ‚ Ø§Ø¨ÙˆØ²ÙŠØ¯</option>
            <option>Ù…Ø¬Ø¯Ù‰ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù†</option>
            <option>Ø£Ø­Ù…Ø¯ Ø¹Ø²Øª Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…</option>
            <option>Ø§Ø­Ù…Ø¯ Ø¹Ù„Ù‰ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ø§ÙØ¸ Ù…Ø±Ø³Ù‰</option>
            <option>Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ø­Ù…Ø¯</option>
            <option>Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø­Ø³Ù†Ù‰ Ø¹Ø¨Ø¯Ù‡ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…</option>
            <option>ÙÙˆØ²Ù‰ Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø´Ø§ÙÙ‰ Ù…Ø·ÙŠØ´</option>
            <option>Ø±Ø²Ù‚ Ø³Ù…ÙŠØ± Ø¹Ø§Ø²Ø± Ù…ÙŠØ®Ø§Ø¦ÙŠÙ„</option>
            <option>Ø¹Ù„Ù‰ Ø­Ø³Ù† Ø¹Ù„ÙŠ Ø­Ø³Ù†</option>
            <option>Ø¨Ù„Ø§Ù„ Ø±Ù…Ø¶Ø§Ù† Ù‚Ø·Ø¨ Ø­Ø³Ù†</option>
            <option>Ù‡Ø§Ù†Ù‰ Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„ÙØªØ§Ø­</option>
            <option>Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯</option>
            <option>Ù†Ø§Ø¯Ø± Ù†Ø¬ÙŠØ¨ Ø­Ù†Ø§ ÙŠØ¹Ù‚ÙˆØ¨</option>
            <option>Ø§ÙŠÙ…Ù† Ø¬Ù…Ø§Ù„ Ø¬Ø±Ø¬Ø³ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…</option>
            <option>Ù‡ÙŠØ«Ù… Ù…ØµØ·ÙÙ‰ Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ø·ÙŠÙ</option>
        </select>
    </div>

    <div class="input-group">
        <select id="office-location">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙƒØªØ¨...</option>
            <option value="Gesr Suez">Gesr Suez</option>
            <option value="Downtown">Downtown</option>
            <option value="Mohandseen">Mohandseen</option>
        </select>
    </div>

    <button class="btn-geo" onclick="getLocation()">
        <i class="fas fa-map-marker-alt"></i> ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ
    </button>
    
    <div id="location-status">Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ù… ÙŠØ­Ø¯Ø¯ Ø¨Ø¹Ø¯</div>

    <button class="btn-attendance" onclick="startCameraProcess('Ø­Ø¶ÙˆØ±')">
        <i class="fas fa-check"></i> ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±
    </button>
    
    <button class="btn-leave" onclick="startCameraProcess('Ø§Ù†ØµØ±Ø§Ù')">
        <i class="fas fa-times"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù†ØµØ±Ø§Ù
    </button>

    <div class="warning-box">
        <strong>âš ï¸ Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹:</strong>
        â€¢ Ù„Ø§Ø²Ù… Ø§Ù„ØµÙˆØ±Ø© ØªÙƒÙˆÙ† ÙˆØ§Ø¶Ø­Ø©.<br>
        â€¢ Ø±ÙƒØ² ÙˆØ§Ù†Øª Ø¨ØªØ¶ØºØ· ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ± Ø£Ùˆ Ø§Ù†ØµØ±Ø§Ù.<br>
        â€¢ Ù„Ø§Ø²Ù… ØªØ¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹.<br>
        â€¢ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙŠØªÙ… ØªØºÙŠØ¨ Ø§Ù„ÙÙ†ÙŠ.
    </div>
</div>

<div id="camera-overlay">
    <div id="camera-content">
        <div id="camera-container">
            <video id="video" autoplay playsinline></video>
            <div id="countdown"></div>
        </div>
        <p style="text-align:center; font-weight:bold; color:var(--primary-color);">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©...</p>
    </div>
</div>

<script>
    const ADMIN_USER = "admin";
    const ADMIN_PASS = "123";

    function handleLogin() {
        const u = document.getElementById('username').value;
        const p = document.getElementById('password').value;
        if(u === ADMIN_USER && p === ADMIN_PASS) {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('main-page').classList.remove('hidden');
        } else {
            document.getElementById('login-error').style.display = 'block';
        }
    }

    async function getLocation() {
        const status = document.getElementById('location-status');
        status.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...';
        navigator.geolocation.getCurrentPosition(async (pos) => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            try {
                const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&accept-language=ar`);
                const data = await res.json();
                status.innerHTML = `<div class="address-box"><b>ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</b><br>${data.display_name}</div>`;
            } catch (e) { status.innerHTML = "ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ÙÙ‚Ø·."; }
        }, () => { status.innerHTML = "ÙØ´Ù„ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹."; });
    }

    async function startCameraProcess(type) {
        const tech = document.getElementById('technician-name').value;
        const office = document.getElementById('office-location').value;
        if(!tech || !office) { alert("Ø§Ø®ØªØ± Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„Ù…ÙƒØªØ¨ Ø£ÙˆÙ„Ø§Ù‹!"); return; }

        const overlay = document.getElementById('camera-overlay');
        const video = document.getElementById('video');
        const countdownEl = document.getElementById('countdown');
        
        overlay.style.display = 'flex'; // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙÙˆÙ‚ Ø§Ù„ÙƒÙ„

        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
            video.srcObject = stream;
            let count = 3;
            countdownEl.innerText = count;
            
            const timer = setInterval(() => {
                count--;
                if(count > 0) {
                    countdownEl.innerText = count;
                } else {
                    clearInterval(timer);
                    countdownEl.innerText = "ğŸ“¸";
                    setTimeout(() => {
                        alert(`ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${type} Ø¨Ù†Ø¬Ø§Ø­ Ù„Ù„ÙÙ†ÙŠ: ${tech}`);
                        stream.getTracks().forEach(track => track.stop());
                        overlay.style.display = 'none';
                    }, 500);
                }
            }, 1000);
        } catch (err) {
            alert("ÙØ´Ù„ ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§!");
            overlay.style.display = 'none';
        }
    }
</script>

</body>
</html>