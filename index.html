<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        * { box-sizing: border-box; touch-action: manipulation; }
        
        :root {
            --primary: #4e73df;
            --success: #1cc88a;
            --danger: #e74a3b;
            --dark: #2c3e50;
        }

        body, html {
            height: 100%;
            margin: 0;
            overflow: hidden; /* Ù…Ù†Ø¹ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ */
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: #f4f7f6;
        }

        .page-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100dvh; /* ÙŠØªÙƒÙŠÙ Ù…Ø¹ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ */
            padding: 15px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
            position: relative;
        }

        h2 { color: var(--dark); margin-bottom: 20px; font-size: 1.4rem; }

        .input-group { position: relative; margin-bottom: 12px; }
        .input-group i { 
            position: absolute; right: 15px; top: 50%; 
            transform: translateY(-50%); color: var(--primary); 
        }
        
        input, select {
            width: 100%;
            padding: 14px 45px 14px 15px;
            border: 2px solid #edf0f5;
            border-radius: 12px;
            font-size: 15px;
            outline: none;
            background: #fcfdfe;
        }

        button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: 0.3s;
        }

        .btn-login, .btn-geo { background: var(--primary); color: white; }
        .btn-attendance { background: var(--success); color: white; }
        .btn-leave { background: var(--danger); color: white; }

        #location-display {
            background: #eef2f7;
            padding: 10px;
            border-radius: 10px;
            font-size: 12px;
            margin: 10px 0;
            text-align: right;
            border-right: 4px solid var(--primary);
            min-height: 50px;
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
        #camera-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        #camera-content {
            width: 280px;
            height: 280px;
            border: 4px solid white;
            border-radius: 50%;
            overflow: hidden;
            position: relative;
        }

        video { width: 100%; height: 100%; object-fit: cover; }

        #countdown {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px; color: white; font-weight: bold;
            text-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .hidden { display: none; }

       /* ØªØ£Ø«ÙŠØ± ØªØ¹ØªÙŠÙ… Ø§Ù„Ø®Ù„ÙÙŠØ© */
#menu-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.4);
    backdrop-filter: blur(4px);
    display: none;
    z-index: 1999;
}

/* Ø²Ø± Ø§Ù„Ù‡Ø§Ù…Ø¨Ø±Ø¬Ø± Ø§Ù„Ù…ØªØ­Ø±Ùƒ */
#menu-toggle {
    position: fixed;
    top: 25px; right: 25px;
    width: 40px; height: 30px;
    cursor: pointer; z-index: 2001;
    display: none; flex-direction: column; justify-content: space-between;
}

#menu-toggle div {
    width: 100%; height: 4px;
    background: var(--primary);
    border-radius: 5px;
    transition: 0.4s;
}

/* ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø²Ø± Ù„Ø¹Ù„Ø§Ù…Ø© X Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­ */
.open .bar1 { transform: rotate(-45deg) translate(-9px, 8px); }
.open .bar2 { opacity: 0; }
.open .bar3 { transform: rotate(45deg) translate(-9px, -8px); }

/* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ© */
#side-menu {
    position: fixed;
    top: 0; right: -300px;
    width: 300px; height: 100%;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    z-index: 2000;
    transition: 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
    padding: 40px 20px;
    border-radius: 30px 0 0 30px;
}

#side-menu.active { right: 0; }

/* Ù‚Ø³Ù… Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù†ÙŠÙˆ */
.user-profile-section { text-align: center; margin-bottom: 40px; }
.avatar {
    width: 70px; height: 70px;
    background: var(--primary);
    color: white;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 30px; margin: 0 auto 15px;
    box-shadow: 0 10px 20px rgba(78,115,223,0.3);
}

/* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ£Ù†ÙŠÙ…ÙŠØ´Ù† Ø§Ù„Ø¸Ù‡ÙˆØ± Ø§Ù„ØªØ¯Ø±ÙŠØ¬ÙŠ */
.menu-list { list-style: none; padding: 0; }
.menu-list li {
    background: #f8f9fc;
    margin-bottom: 15px;
    padding: 12px 15px;
    border-radius: 15px;
    display: flex; align-items: center; gap: 15px;
    cursor: pointer;
    transition: 0.3s;
    transform: translateX(50px); opacity: 0; /* Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† */
}

#side-menu.active .menu-list li {
    transform: translateX(0); opacity: 1;
    transition: 0.4s ease forwards;
    transition-delay: calc(var(--i) * 0.1s); /* ØªØ£Ø®ÙŠØ± Ù„ÙƒÙ„ Ø¹Ù†ØµØ± */
}

.icon-box {
    width: 40px; height: 40px;
    background: white;
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    color: var(--primary);
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
}

.menu-list li:hover {
    background: var(--primary); color: white;
    transform: scale(1.05) !important;
}
.menu-list li:hover .icon-box { color: var(--primary); }

.btn-logout {
    margin-top: 50px;
    background: #fff0f0; color: #e74a3b;
    border: 1px solid #ffe0e0;
}

.hidden { display: none !important; }

    </style>
</head>
<body>

    <div id="menu-overlay" onclick="toggleMenu()"></div>

<div id="menu-toggle" onclick="toggleMenu()">
    <div class="bar1"></div>
    <div class="bar2"></div>
    <div class="bar3"></div>
</div>

<nav id="side-menu">
    <div class="menu-content">
        <div class="user-profile-section">
            <div class="avatar"><i class="fas fa-user-tie"></i></div>
            <h4 id="user-name-display">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</h4>
            <p>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</p>
        </div>
        
        <ul class="menu-list">
            <li style="--i:1" onclick="goToPage('attendance')">
                <div class="icon-box"><i class="fas fa-fingerprint"></i></div>
                <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ±</span>
            </li>
            <li style="--i:4" onclick="goToPage('attendance-history')">
    <div class="icon-box"><i class="fas fa-history"></i></div>
    <span>Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±</span>
</li>
            <li style="--i:2" onclick="goToPage('leave-request')">
                <div class="icon-box"><i class="fas fa-paper-plane"></i></div>
                <span>Ø·Ù„Ø¨ Ø¥Ø¬Ø§Ø²Ø©</span>
            </li>
            <li style="--i:3" onclick="goToPage('leave-status')">
                <div class="icon-box"><i class="fas fa-clock-rotate-left"></i></div>
                <span>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
            </li>
        </ul>
        
        <div class="menu-footer">
            <button onclick="location.reload()" class="btn-logout">
                <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            </button>
        </div>
    </div>
</nav>

<div class="page-wrapper">
    <div id="login-page" class="card">
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <div class="input-group">
            <i class="fas fa-user"></i>
            <input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        </div>
        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        </div>
        <button class="btn-login" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div id="main-page" class="card hidden">
        <h2 id="company-name">Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</h2>
        
        <select id="tech-name" style="margin-bottom: 10px;">
            <option value="">Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„ÙÙ†ÙŠ...</option>
            <option>Ø¹Ù„Ù‰ Ø§Ø­Ù…Ø¯ Ø·Ù†Ø·Ø§ÙˆÙ‰ Ù…Ù†ØµÙˆØ±</option>
            <option>Ø´Ø§Ø¯Ù‰ Ø±Ø£ÙØª Ø±ÙØ§Ø¹Ù‰ Ù…Ø­Ù…ÙˆØ¯ ØµØ§Ù„Ø­</option>
            <option>Ù…Ø­Ù…Ø¯ Ø­Ø³ÙŠÙ† Ù…Ø­Ù…Ø¯ Ø¹Ø§Ù…Ø±</option>
            <option>Ù…ØµØ·ÙÙŠ Ø³Ø§Ù…Ù‰ Ù…ØµØ·ÙÙŠ Ø¯Ø§ÙˆØ¯</option>
            <option>Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ Ø£Ø¨Ø±Ø§Ù‡ÙŠÙ…</option>
            <option>Ù…Ø­Ù…ÙˆØ¯ Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ù„Ø¨Ù„ÙŠÙ‡Ù‰</option>
            <option>Ø³Ø¹ÙŠØ¯ Ø­Ø³ÙŠÙ† Ø¹Ù„ÙŠ Ø£Ø³Ù…Ø§Ø¹ÙŠÙ„</option>
            <option>Ù…Ø­Ù…ÙˆØ¯ Ù…Ø­Ù…Ø¯ Ù…Ø­Ù…ÙˆØ¯ Ø£Ø­Ù…Ø¯</option>
            <option>Ø¨Ø§Ø³Ù… Ù†Ø´Ø£Øª ØµØ§Ù„Ø­</option>
            <option>Ø§Ø¨Ø§Ù†ÙˆØ¨ Ø²ØºÙ„ÙˆÙ„ Ø¹Ø§Ø²Ø± Ù…ÙŠØ®Ø§Ø¦ÙŠÙ„</option>
            <option>Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ù‡ ØªÙˆÙÙŠÙ‚ Ø§Ø¨ÙˆØ²ÙŠØ¯</option>
            <option>Ù…Ø¬Ø¯Ù‰ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù†</option>
            <option>Ø£Ø­Ù…Ø¯ Ø¹Ø²Øª Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…</option>
            <option>Ø§Ø­Ù…Ø¯ Ø¹Ù„Ù‰ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ø§ÙØ¸ Ù…Ø±Ø³Ù‰</option>
            <option>Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ø­Ù…Ø¯</option>
            <option>Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø­Ø³Ù†Ù‰ Ø¹Ø¨Ø¯Ù‡ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…</option>
            <option>ÙÙˆØ²Ù‰ Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø´Ø§ÙÙ‰ Ù…Ø·ÙŠØ´</option>
            <option>Ø±Ø²Ù‚ Ø³Ù…ÙŠØ± Ø¹Ø§Ø²Ø± Ù…ÙŠØ®Ø§Ø¦ÙŠÙ„</option>
            <option>Ø¹Ù„Ù‰ Ø­Ø³Ù† Ø¹Ù„ÙŠ Ø­Ø³Ù†</option>
            <option>Ø¨Ù„Ø§Ù„ Ø±Ù…Ø¶Ø§Ù† Ù‚Ø·Ø¨ Ø­Ø³Ù†</option>
            <option>Ù‡Ø§Ù†Ù‰ Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„ÙØªØ§Ø­</option>
            <option>Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯</option>
            <option>Ù†Ø§Ø¯Ø± Ù†Ø¬ÙŠØ¨ Ø­Ù†Ø§ ÙŠØ¹Ù‚ÙˆØ¨</option>
            <option>Ø§ÙŠÙ…Ù† Ø¬Ù…Ø§Ù„ Ø¬Ø±Ø¬Ø³ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…</option>
            <option>Ù‡ÙŠØ«Ù… Ù…ØµØ·ÙÙ‰ Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ø·ÙŠÙ</option>
        </select>
        
        <select id="office" style="margin-bottom: 10px;">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙƒØªØ¨...</option>
            <option value="Gesr Suez">Gesr Suez</option>
            <option value="Downtown">Downtown</option>
            <option value="Mohandseen">Mohandseen</option>
        </select>

        <button class="btn-geo" onclick="getSuperFineLocation()">
            <i class="fas fa-satellite"></i> ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø¯Ù‚ÙŠÙ‚ Ø¬Ø¯Ø§Ù‹
        </button>
        
        <div id="location-display">Ø§Ù„Ù…ÙˆÙ‚Ø¹: Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ¯...</div>

        <button class="btn-attendance" onclick="startProcess('Ø­Ø¶ÙˆØ±')">ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±</button>
        <button class="btn-leave" onclick="startProcess('Ø§Ù†ØµØ±Ø§Ù')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù†ØµØ±Ø§Ù</button>

        <p style="font-size: 10px; color: #777; margin: 0;">âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€ GPS Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¯Ù‚Ø©</p>
    </div>

    <div id="leave-request-page" class="card hidden">
    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
        <button onclick="backToMain()" style="width: 40px; padding: 10px; margin: 0; background: #eee; color: #333; border-radius: 50%;">
            <i class="fas fa-arrow-right"></i>
        </button>
        <h2 style="margin: 0;">Ø·Ù„Ø¨ Ø¥Ø¬Ø§Ø²Ø© Ø¬Ø¯ÙŠØ¯</h2>
    </div>

    <div class="input-group">
        <i class="fas fa-calendar-day"></i>
        <select id="leave-type" onchange="checkLeaveType()">
            <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©...</option>
            <option value="Ø³Ù†ÙˆÙŠØ©">Ø¥Ø¬Ø§Ø²Ø© Ø³Ù†ÙˆÙŠØ©</option>
            <option value="Ù…Ø±Ø¶ÙŠØ©">Ø¥Ø¬Ø§Ø²Ø© Ù…Ø±Ø¶ÙŠØ©</option>
            <option value="Ø¥Ø°Ù†">Ø¥Ø°Ù† Ø®Ø±ÙˆØ¬</option>
        </select>
    </div>

    <div style="text-align: right; margin-bottom: 10px;">
        <label style="font-size: 13px; color: var(--primary); font-weight: bold;">ØªØ§Ø±ÙŠØ® Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© (Ù…Ù†):</label>
        <div class="input-group">
            <i class="fas fa-calendar-alt"></i>
            <input type="date" id="leave-start">
        </div>
    </div>

    <div style="text-align: right; margin-bottom: 10px;">
        <label style="font-size: 13px; color: var(--primary); font-weight: bold;">ØªØ§Ø±ÙŠØ® Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© (Ø¥Ù„Ù‰):</label>
        <div class="input-group">
            <i class="fas fa-calendar-check"></i>
            <input type="date" id="leave-end">
        </div>
    </div>

    <div id="medical-upload-section" class="hidden" style="text-align: right; margin-bottom: 15px;">
        <label style="font-size: 13px; color: var(--danger); font-weight: bold;">Ø¥Ø±ÙØ§Ù‚ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø·Ø¨ÙŠØ© (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ):</label>
        <div class="input-group" style="margin-top: 5px;">
            <i class="fas fa-camera" style="z-index: 5;"></i>
            <input type="file" id="leave-files" multiple accept="image/*" style="padding-top: 10px;">
        </div>
    </div>

    <div class="input-group">
        <i class="fas fa-comment-dots"></i>
        <textarea id="leave-reason" placeholder="Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø£Ùˆ Ø³Ø¨Ø¨ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©..." style="width: 100%; border-radius: 12px; border: 2px solid #edf0f5; padding: 10px 45px 10px 10px; height: 80px; font-family: inherit; outline: none;"></textarea>
    </div>

    <button class="btn-attendance" onclick="submitLeave()">
        <i class="fas fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
    </button>
</div>

<div id="attendance-history-page" class="card hidden" style="max-width: 600px;">
    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
        <button onclick="backToMain()" style="width: 40px; padding: 10px; margin: 0; background: #eee; color: #333; border-radius: 50%;">
            <i class="fas fa-arrow-right"></i>
        </button>
        <h2 style="margin: 0;">Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±: <span id="dynamic-user-history">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</span></h2>
    </div>

    <div style="overflow-x: auto; border-radius: 15px; border: 1px solid #edf0f5;">
        <table style="width: 100%; border-collapse: collapse; text-align: center; font-size: 12px; min-width: 500px;">
            <thead>
                <tr style="background: #f8f9fc; color: var(--primary); border-bottom: 2px solid #edf0f5;">
                    <th style="padding: 12px;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th style="padding: 12px;">Ø§Ù„Ø§Ø³Ù…</th>
                    <th style="padding: 12px;">Ø­Ø¶ÙˆØ±</th>
                    <th style="padding: 12px;">Ø§Ù†ØµØ±Ø§Ù</th>
                    <th style="padding: 12px;">ØªØ£Ø®ÙŠØ±</th>
                    <th style="padding: 12px;">Ø¥Ø¶Ø§ÙÙŠ</th>
                </tr>
            </thead>
            <tbody id="history-table-body">
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 12px; font-weight: bold;">2023-10-25</td>
                    <td style="padding: 12px; color: #555;">Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯</td>
                    <td style="padding: 12px; color: var(--success); font-weight: bold;">08:30</td>
                    <td style="padding: 12px; color: var(--danger); font-weight: bold;">04:30</td>
                    <td style="padding: 12px;"><span style="background: #fff0f0; color: #e74a3b; padding: 2px 8px; border-radius: 5px;">00:30</span></td>
                    <td style="padding: 12px;"><span style="background: #f0fff4; color: #28a745; padding: 2px 8px; border-radius: 5px;">01:00</span></td>
                </tr>
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 12px; font-weight: bold;">2023-10-24</td>
                    <td style="padding: 12px; color: #555;">Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯</td>
                    <td style="padding: 12px; color: var(--success); font-weight: bold;">07:55</td>
                    <td style="padding: 12px; color: var(--danger); font-weight: bold;">04:00</td>
                    <td style="padding: 12px; color: #aaa;">--:--</td>
                    <td style="padding: 12px; color: #aaa;">--:--</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

</div>

<div id="camera-overlay">
    <div id="camera-content">
        <video id="video" autoplay playsinline></video>
        <div id="countdown"></div>
    </div>
    <h3 style="color: white; margin-top: 20px;">Ø«Ø¨Ø§Øª.. Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØµÙˆÙŠØ±</h3>
</div>

<script>
   function login() {
    const u = document.getElementById('username').value;
    const p = document.getElementById('password').value;
    
    if(u === "admin" && p === "123") {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³Ù… ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
        document.getElementById('user-name-display').innerText = "Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ " + u;
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ ØµÙØ­Ø© Ø³Ø¬Ù„ Ø§Ù„Ø­Ø¶ÙˆØ± [ØªØ¹Ø¯ÙŠÙ„ Ø¬Ø¯ÙŠØ¯]
        document.getElementById('dynamic-user-history').innerText = u;
        
        document.getElementById('login-page').style.display = 'none';
        document.getElementById('main-page').classList.remove('hidden');
        document.getElementById('menu-toggle').style.display = 'flex';
        
        // Ø§Ø®ØªÙŠØ§Ø±ÙŠØ§Ù‹: ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© Ù‡Ù†Ø§ Ù„Ù…Ù„Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙ‚Ø· Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§ØªÙƒ
    } else {
        Swal.fire({ icon: 'error', title: 'Ø®Ø·Ø£', text: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©' });
    }
}

    let currentLat, currentLon, locationCaptured = false;

    // Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø¯Ù‚Ø© ÙØ§Ø¦Ù‚Ø©
    async function getSuperFineLocation() {
        const display = document.getElementById('location-display');
        
        if (!navigator.geolocation) {
            Swal.fire('Ø®Ø·Ø£', 'Ø¬Ù‡Ø§Ø²Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ù€ GPS', 'error');
            return;
        }

        display.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø£Ù‚Ù…Ø§Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©...';
        
        // Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„Ù‚ØµÙˆÙ‰
        const options = {
            enableHighAccuracy: true, // ØªÙØ¹ÙŠÙ„ Ø£Ø¹Ù„Ù‰ Ø¯Ù‚Ø© (GPS)
            timeout: 15000,           // Ø§Ù†ØªØ¸Ø§Ø± 15 Ø«Ø§Ù†ÙŠØ© ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰
            maximumAge: 0             // Ø¹Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹ Ù…Ø®Ø²Ù† Ù‚Ø¯ÙŠÙ…
        };

        navigator.geolocation.getCurrentPosition(async (pos) => {
            currentLat = pos.coords.latitude;
            currentLon = pos.coords.longitude;
            const accuracy = pos.coords.accuracy; // Ø¯Ù‚Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø§Ù„Ø£Ù…ØªØ§Ø±

            try {
                const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${currentLat}&lon=${currentLon}&accept-language=ar`);
                const data = await res.json();
                const address = data.display_name;

                display.innerHTML = `
                    <b>ğŸ“ ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø¨Ø¯Ù‚Ø© (Â±${accuracy.toFixed(1)} Ù…ØªØ±):</b><br>
                    <span style="color:var(--dark)">${address}</span>
                `;
                locationCaptured = true;
                Swal.fire({ icon: 'success', title: 'ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø¨Ø¯Ù‚Ø©', text: `Ù†Ø³Ø¨Ø© Ø§Ù„Ø®Ø·Ø£ ÙÙ‚Ø· ${accuracy.toFixed(1)} Ù…ØªØ±`, timer: 2000 });
            } catch (e) {
                display.innerText = `ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª: ${currentLat}, ${currentLon}`;
            }
        }, (err) => {
            Swal.fire('Ø®Ø·Ø£', 'Ø¨Ø±Ø¬Ø§Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„', 'error');
            display.innerText = "ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ¯!";
        }, options);
    }

    async function startProcess(type) {
        const tech = document.getElementById('tech-name').value;
        const office = document.getElementById('office').value;

        if(!tech || !office) {
            Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„Ù…ÙƒØªØ¨', 'warning');
            return;
        }
        if(!locationCaptured) {
            Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ Ø£ÙˆÙ„Ø§Ù‹', 'warning');
            return;
        }

        const overlay = document.getElementById('camera-overlay');
        const video = document.getElementById('video');
        const countEl = document.getElementById('countdown');

        overlay.style.display = 'flex';

        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
            video.srcObject = stream;
            
            let timer = 3;
            countEl.innerText = timer;

            const interval = setInterval(() => {
                timer--;
                if(timer > 0) {
                    countEl.innerText = timer;
                } else {
                    clearInterval(interval);
                    countEl.innerText = "ğŸ“¸";
                    setTimeout(() => {
                        stream.getTracks().forEach(t => t.stop());
                        overlay.style.display = 'none';
                        // --- Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¬Ø¯ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ---
const tableBody = document.getElementById('history-table-body');
const today = new Date().toLocaleDateString('en-CA'); // ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… (YYYY-MM-DD)
const now = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false });
const loggedInUser = document.getElementById('username').value; // Ø¬Ù„Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ

const newRow = `
    <tr style="border-bottom: 1px solid #eee;">
        <td style="padding: 12px; font-weight: bold;">${today}</td>
        <td style="padding: 12px; color: #555;">${loggedInUser}</td>
        <td style="padding: 12px; color: var(--success); font-weight: bold;">${type === 'Ø­Ø¶ÙˆØ±' ? now : '--:--'}</td>
        <td style="padding: 12px; color: var(--danger); font-weight: bold;">${type === 'Ø§Ù†ØµØ±Ø§Ù' ? now : '--:--'}</td>
        <td style="padding: 12px; color: #aaa;">--:--</td>
        <td style="padding: 12px; color: #aaa;">--:--</td>
    </tr>
`;

// Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„
tableBody.innerHTML = newRow + tableBody.innerHTML;
// --------------------------------------
                        Swal.fire({
                            icon: 'success',
                            title: 'ØªÙ… Ø¨Ù†Ø¬Ø§Ø­',
                            text: `ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${type} Ù„Ù„ÙÙ†ÙŠ ${tech} ÙÙŠ Ù…ÙƒØªØ¨ ${office}`,
                            confirmButtonText: 'Ù…Ù…ØªØ§Ø²'
                        });
                    }, 600);
                }
            }, 1000);
        } catch(e) {
            Swal.fire('Ø®Ø·Ø£', 'ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§', 'error');
            overlay.style.display = 'none';
        }
    }

    function toggleMenu() {
    document.getElementById('side-menu').classList.toggle('active');
}

function toggleMenu() {
    const menu = document.getElementById('side-menu');
    const btn = document.getElementById('menu-toggle');
    const overlay = document.getElementById('menu-overlay');
    
    menu.classList.toggle('active');
    btn.classList.toggle('open');
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø£Ùˆ Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ¹ØªÙŠÙ… Ø®Ù„Ù Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    if (menu.classList.contains('active')) {
        overlay.style.display = 'block';
    } else {
        overlay.style.display = 'none';
    }
}

// ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ· Ø¹Ù„Ù‰ Ø¯Ø§Ù„Ø© Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„
function goToPage(page) {
    toggleMenu(); // ØºÙ„Ù‚ Ø§Ù„Ù…Ù†ÙŠÙˆ
    
    // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø·Ù‚ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
    const titles = {
        'attendance': 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨',
        'leave-request': 'ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨ Ø¥Ø¬Ø§Ø²Ø© Ø¬Ø¯ÙŠØ¯',
        'leave-status': 'Ù…ØªØ§Ø¨Ø¹Ø© Ø­Ø§Ù„Ø© Ø·Ù„Ø¨Ø§ØªÙƒ'
    };
    
    Swal.fire({
        title: titles[page],
        text: 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø³Ù…...',
        icon: 'info',
        timer: 1500,
        showConfirmButton: false
    });
}

// ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
// ØªØ­Ø¯ÙŠØ« ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª
function goToPage(page) {
    toggleMenu(); // ØºÙ„Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
    
    // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª Ø£ÙˆÙ„Ø§Ù‹
    document.getElementById('main-page').classList.add('hidden');
    document.getElementById('leave-request-page').classList.add('hidden');
    document.getElementById('attendance-history-page').classList.add('hidden'); // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø³Ø¬Ù„
    
    if(page === 'attendance') {
        document.getElementById('main-page').classList.remove('hidden');
    } 
    else if(page === 'leave-request') {
        document.getElementById('leave-request-page').classList.remove('hidden');
    }
    else if(page === 'attendance-history') {
        document.getElementById('attendance-history-page').classList.remove('hidden');
    }
    else if(page === 'leave-status') {
        Swal.fire('Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø³Ø§Ø¨Ù‚Ø© Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø­Ø§Ù„ÙŠØ§Ù‹', 'info');
        document.getElementById('main-page').classList.remove('hidden');
    }
}

// ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
function backToMain() {
    document.getElementById('leave-request-page').classList.add('hidden');
    document.getElementById('attendance-history-page').classList.add('hidden'); // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø³Ø¬Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø©
    document.getElementById('main-page').classList.remove('hidden');
}

// Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
// Ø¯Ø§Ù„Ø© Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø­Ù‚Ù„ Ø§Ù„Ø±ÙØ¹
function checkLeaveType() {
    const type = document.getElementById('leave-type').value;
    const uploadSection = document.getElementById('medical-upload-section');
    
    if (type === 'Ù…Ø±Ø¶ÙŠØ©') {
        uploadSection.classList.remove('hidden');
    } else {
        uploadSection.classList.add('hidden');
        document.getElementById('leave-files').value = ''; // Ù…Ø³Ø­ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ø°Ø§ ØºÙŠØ± Ø§Ù„Ù†ÙˆØ¹
    }
}

// ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙˆØ±
function submitLeave() {
    const type = document.getElementById('leave-type').value;
    const start = document.getElementById('leave-start').value;
    const end = document.getElementById('leave-end').value;
    const files = document.getElementById('leave-files').files;

    // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    if(!type || !start || !end) {
        Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø¨Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©', 'warning');
        return;
    }

    // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ Ù…Ù† Ø§Ù„ØµÙˆØ± ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„Ù…Ø±Ø¶ÙŠØ©
    if(type === 'Ù…Ø±Ø¶ÙŠØ©' && files.length === 0) {
        Swal.fire({
            icon: 'error',
            title: 'Ù…Ø±ÙÙ‚Ø§Øª Ù†Ø§Ù‚ØµØ©',
            text: 'ÙŠØ¬Ø¨ Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø·Ø¨ÙŠ Ù„ØªÙ‚Ø¯ÙŠÙ… Ø¥Ø¬Ø§Ø²Ø© Ù…Ø±Ø¶ÙŠØ©',
            confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
        });
        return;
    }

    // Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
    Swal.fire({
        title: 'ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„!',
        text: 'ØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ¬Ø§Ø±ÙŠ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª',
        icon: 'success',
        confirmButtonText: 'Ù…Ù…ØªØ§Ø²'
    }).then(() => {
        // ØªÙØ±ÙŠØº Ø§Ù„ÙÙˆØ±Ù… ÙˆØ§Ù„Ø¹ÙˆØ¯Ø©
        document.getElementById('leave-type').value = '';
        document.getElementById('leave-start').value = '';
        document.getElementById('leave-end').value = '';
        document.getElementById('leave-files').value = '';
        document.getElementById('medical-upload-section').classList.add('hidden');
        backToMain();
    });
}

</script>
</body>
</html>
