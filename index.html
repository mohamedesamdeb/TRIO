<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        * { box-sizing: border-box; touch-action: manipulation; }
        
        :root {
            --primary: #4e73df;
            --success: #1cc88a;
            --danger: #e74a3b;
            --dark: #2c3e50;
        }

        body, html {
            height: 100%;
            margin: 0;
            overflow: hidden; /* Ù…Ù†Ø¹ Ø§Ù„Ø³ÙƒØ±ÙˆÙ„ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ */
            font-family: 'Segoe UI', Tahoma, sans-serif;
            background: #f4f7f6;
        }

        .page-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100dvh; /* ÙŠØªÙƒÙŠÙ Ù…Ø¹ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ */
            padding: 15px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
            position: relative;
        }

        h2 { color: var(--dark); margin-bottom: 20px; font-size: 1.4rem; }

        .input-group { position: relative; margin-bottom: 12px; }
        .input-group i { 
            position: absolute; right: 15px; top: 50%; 
            transform: translateY(-50%); color: var(--primary); 
        }
        
        input, select {
            width: 100%;
            padding: 14px 45px 14px 15px;
            border: 2px solid #edf0f5;
            border-radius: 12px;
            font-size: 15px;
            outline: none;
            background: #fcfdfe;
        }

        button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: 0.3s;
        }

        .btn-login, .btn-geo { background: var(--primary); color: white; }
        .btn-attendance { background: var(--success); color: white; }
        .btn-leave { background: var(--danger); color: white; }

        #location-display {
            background: #eef2f7;
            padding: 10px;
            border-radius: 10px;
            font-size: 12px;
            margin: 10px 0;
            text-align: right;
            border-right: 4px solid var(--primary);
            min-height: 50px;
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© */
        #camera-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        #camera-content {
            width: 280px;
            height: 280px;
            border: 4px solid white;
            border-radius: 50%;
            overflow: hidden;
            position: relative;
        }

        video { width: 100%; height: 100%; object-fit: cover; }

        #countdown {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px; color: white; font-weight: bold;
            text-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="page-wrapper">
    <div id="login-page" class="card">
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <div class="input-group">
            <i class="fas fa-user"></i>
            <input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        </div>
        <div class="input-group">
            <i class="fas fa-lock"></i>
            <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        </div>
        <button class="btn-login" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <div id="main-page" class="card hidden">
        <h2 id="company-name">Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©</h2>
        
        <select id="tech-name" style="margin-bottom: 10px;">
            <option value="">Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„ÙÙ†ÙŠ...</option>
            <option>Ø¹Ù„Ù‰ Ø§Ø­Ù…Ø¯ Ø·Ù†Ø·Ø§ÙˆÙ‰ Ù…Ù†ØµÙˆØ±</option>
            <option>Ø´Ø§Ø¯Ù‰ Ø±Ø£ÙØª Ø±ÙØ§Ø¹Ù‰ Ù…Ø­Ù…ÙˆØ¯ ØµØ§Ù„Ø­</option>
            <option>Ù…Ø­Ù…Ø¯ Ø­Ø³ÙŠÙ† Ù…Ø­Ù…Ø¯ Ø¹Ø§Ù…Ø±</option>
            <option>Ù…ØµØ·ÙÙŠ Ø³Ø§Ù…Ù‰ Ù…ØµØ·ÙÙŠ Ø¯Ø§ÙˆØ¯</option>
            <option>Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯ Ø£Ø¨Ø±Ø§Ù‡ÙŠÙ…</option>
            <option>Ù…Ø­Ù…ÙˆØ¯ Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ù„Ø¨Ù„ÙŠÙ‡Ù‰</option>
            <option>Ø³Ø¹ÙŠØ¯ Ø­Ø³ÙŠÙ† Ø¹Ù„ÙŠ Ø£Ø³Ù…Ø§Ø¹ÙŠÙ„</option>
            <option>Ù…Ø­Ù…ÙˆØ¯ Ù…Ø­Ù…Ø¯ Ù…Ø­Ù…ÙˆØ¯ Ø£Ø­Ù…Ø¯</option>
            <option>Ø¨Ø§Ø³Ù… Ù†Ø´Ø£Øª ØµØ§Ù„Ø­</option>
            <option>Ø§Ø¨Ø§Ù†ÙˆØ¨ Ø²ØºÙ„ÙˆÙ„ Ø¹Ø§Ø²Ø± Ù…ÙŠØ®Ø§Ø¦ÙŠÙ„</option>
            <option>Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ù‡ ØªÙˆÙÙŠÙ‚ Ø§Ø¨ÙˆØ²ÙŠØ¯</option>
            <option>Ù…Ø¬Ø¯Ù‰ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù†</option>
            <option>Ø£Ø­Ù…Ø¯ Ø¹Ø²Øª Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…</option>
            <option>Ø§Ø­Ù…Ø¯ Ø¹Ù„Ù‰ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ø§ÙØ¸ Ù…Ø±Ø³Ù‰</option>
            <option>Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ø­Ù…Ø¯</option>
            <option>Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø­Ø³Ù†Ù‰ Ø¹Ø¨Ø¯Ù‡ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…</option>
            <option>ÙÙˆØ²Ù‰ Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø´Ø§ÙÙ‰ Ù…Ø·ÙŠØ´</option>
            <option>Ø±Ø²Ù‚ Ø³Ù…ÙŠØ± Ø¹Ø§Ø²Ø± Ù…ÙŠØ®Ø§Ø¦ÙŠÙ„</option>
            <option>Ø¹Ù„Ù‰ Ø­Ø³Ù† Ø¹Ù„ÙŠ Ø­Ø³Ù†</option>
            <option>Ø¨Ù„Ø§Ù„ Ø±Ù…Ø¶Ø§Ù† Ù‚Ø·Ø¨ Ø­Ø³Ù†</option>
            <option>Ù‡Ø§Ù†Ù‰ Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„ÙØªØ§Ø­</option>
            <option>Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯</option>
            <option>Ù†Ø§Ø¯Ø± Ù†Ø¬ÙŠØ¨ Ø­Ù†Ø§ ÙŠØ¹Ù‚ÙˆØ¨</option>
            <option>Ø§ÙŠÙ…Ù† Ø¬Ù…Ø§Ù„ Ø¬Ø±Ø¬Ø³ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…</option>
            <option>Ù‡ÙŠØ«Ù… Ù…ØµØ·ÙÙ‰ Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ø·ÙŠÙ</option>
        </select>
        
        <select id="office" style="margin-bottom: 10px;">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…ÙƒØªØ¨...</option>
            <option value="Gesr Suez">Gesr Suez</option>
            <option value="Downtown">Downtown</option>
            <option value="Mohandseen">Mohandseen</option>
        </select>

        <button class="btn-geo" onclick="getSuperFineLocation()">
            <i class="fas fa-satellite"></i> ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø¯Ù‚ÙŠÙ‚ Ø¬Ø¯Ø§Ù‹
        </button>
        
        <div id="location-display">Ø§Ù„Ù…ÙˆÙ‚Ø¹: Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ¯...</div>

        <button class="btn-attendance" onclick="startProcess('Ø­Ø¶ÙˆØ±')">ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±</button>
        <button class="btn-leave" onclick="startProcess('Ø§Ù†ØµØ±Ø§Ù')">ØªØ³Ø¬ÙŠÙ„ Ø§Ù†ØµØ±Ø§Ù</button>

        <p style="font-size: 10px; color: #777; margin: 0;">âš ï¸ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€ GPS Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¯Ù‚Ø©</p>
    </div>
</div>

<div id="camera-overlay">
    <div id="camera-content">
        <video id="video" autoplay playsinline></video>
        <div id="countdown"></div>
    </div>
    <h3 style="color: white; margin-top: 20px;">Ø«Ø¨Ø§Øª.. Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØµÙˆÙŠØ±</h3>
</div>

<script>
    function login() {
        const u = document.getElementById('username').value;
        const p = document.getElementById('password').value;
        if(u === "admin" && p === "123") {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('main-page').classList.remove('hidden');
        } else {
            Swal.fire({ icon: 'error', title: 'Ø®Ø·Ø£', text: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©', confirmButtonText: 'Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹' });
        }
    }

    let currentLat, currentLon, locationCaptured = false;

    // Ø¯Ø§Ù„Ø© Ø¬Ù„Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø¯Ù‚Ø© ÙØ§Ø¦Ù‚Ø©
    async function getSuperFineLocation() {
        const display = document.getElementById('location-display');
        
        if (!navigator.geolocation) {
            Swal.fire('Ø®Ø·Ø£', 'Ø¬Ù‡Ø§Ø²Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ù€ GPS', 'error');
            return;
        }

        display.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø£Ù‚Ù…Ø§Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©...';
        
        // Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¯Ù‚Ø© Ø§Ù„Ù‚ØµÙˆÙ‰
        const options = {
            enableHighAccuracy: true, // ØªÙØ¹ÙŠÙ„ Ø£Ø¹Ù„Ù‰ Ø¯Ù‚Ø© (GPS)
            timeout: 15000,           // Ø§Ù†ØªØ¸Ø§Ø± 15 Ø«Ø§Ù†ÙŠØ© ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰
            maximumAge: 0             // Ø¹Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹ Ù…Ø®Ø²Ù† Ù‚Ø¯ÙŠÙ…
        };

        navigator.geolocation.getCurrentPosition(async (pos) => {
            currentLat = pos.coords.latitude;
            currentLon = pos.coords.longitude;
            const accuracy = pos.coords.accuracy; // Ø¯Ù‚Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø§Ù„Ø£Ù…ØªØ§Ø±

            try {
                const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${currentLat}&lon=${currentLon}&accept-language=ar`);
                const data = await res.json();
                const address = data.display_name;

                display.innerHTML = `
                    <b>ğŸ“ ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø¨Ø¯Ù‚Ø© (Â±${accuracy.toFixed(1)} Ù…ØªØ±):</b><br>
                    <span style="color:var(--dark)">${address}</span>
                `;
                locationCaptured = true;
                Swal.fire({ icon: 'success', title: 'ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø¨Ø¯Ù‚Ø©', text: `Ù†Ø³Ø¨Ø© Ø§Ù„Ø®Ø·Ø£ ÙÙ‚Ø· ${accuracy.toFixed(1)} Ù…ØªØ±`, timer: 2000 });
            } catch (e) {
                display.innerText = `ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª: ${currentLat}, ${currentLon}`;
            }
        }, (err) => {
            Swal.fire('Ø®Ø·Ø£', 'Ø¨Ø±Ø¬Ø§Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„', 'error');
            display.innerText = "ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ¯!";
        }, options);
    }

    async function startProcess(type) {
        const tech = document.getElementById('tech-name').value;
        const office = document.getElementById('office').value;

        if(!tech || !office) {
            Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'Ø¨Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙÙ†ÙŠ ÙˆØ§Ù„Ù…ÙƒØªØ¨', 'warning');
            return;
        }
        if(!locationCaptured) {
            Swal.fire('ØªÙ†Ø¨ÙŠÙ‡', 'ÙŠØ¬Ø¨ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ Ø£ÙˆÙ„Ø§Ù‹', 'warning');
            return;
        }

        const overlay = document.getElementById('camera-overlay');
        const video = document.getElementById('video');
        const countEl = document.getElementById('countdown');

        overlay.style.display = 'flex';

        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
            video.srcObject = stream;
            
            let timer = 3;
            countEl.innerText = timer;

            const interval = setInterval(() => {
                timer--;
                if(timer > 0) {
                    countEl.innerText = timer;
                } else {
                    clearInterval(interval);
                    countEl.innerText = "ğŸ“¸";
                    setTimeout(() => {
                        stream.getTracks().forEach(t => t.stop());
                        overlay.style.display = 'none';
                        Swal.fire({
                            icon: 'success',
                            title: 'ØªÙ… Ø¨Ù†Ø¬Ø§Ø­',
                            text: `ØªÙ… ØªØ³Ø¬ÙŠÙ„ ${type} Ù„Ù„ÙÙ†ÙŠ ${tech} ÙÙŠ Ù…ÙƒØªØ¨ ${office}`,
                            confirmButtonText: 'Ù…Ù…ØªØ§Ø²'
                        });
                    }, 600);
                }
            }, 1000);
        } catch(e) {
            Swal.fire('Ø®Ø·Ø£', 'ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§', 'error');
            overlay.style.display = 'none';
        }
    }
</script>
</body>
</html>
